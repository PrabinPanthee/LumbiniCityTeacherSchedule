@model IEnumerable<LumbiniCityTeacherSchedule.Models.Models.Subject>

@{
    ViewData["Title"] = "Subject List";
    int semesterId = ViewBag.SemesterId;
    int programId = ViewBag.ProgramId;
}

<div class="card shadow border-0 mt-4">
    <div class="card-header bg-secondary bg-gradient py-3">
        <div class="row">
            <div class="col-12 text-center">
                <h2 class="text-white py-2">Subject List</h2>
            </div>
        </div>
    </div>

    <div class="card-body p-4">
        @* Success and Error Messages *@
        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                @TempData["Success"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
        @if (ViewBag.Error != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                @ViewBag.Error
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        @if (Model != null && Model.Any())
        {
            <table class="table table-bordered text-center align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Subject Name</th>
                        <th>Subject Code</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var subject in Model)
                    {
                        <tr>
                            <td>@subject.SubjectName</td>
                            <td>@subject.SubjectCode</td>
                            <td>
                                <div class="d-flex justify-content-center">
                                    <a asp-controller="Subject" asp-action="Update" asp-route-subjectId="@subject.SubjectId" asp-route-programId ="@programId" class="btn btn-warning btn-sm me-2">
                                        <i class="bi bi-pencil-square"></i> Edit
                                    </a>
                                    <a href="#" onclick="deleteSubject(@subject.SubjectId,this)" class="btn btn-danger btn-sm">
                                        <i class="bi bi-trash"></i> Delete
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-warning text-center" role="alert">
                No subjects available for this semester.
            </div>
        }

        <div class="mt-4 d-flex justify-content-between">
            <a asp-controller="Semester" asp-action="Index" asp-route-id="@programId" class="btn btn-secondary">
                <i class="bi bi-arrow-left-circle"></i> Back to Semester List
            </a>
            <a asp-controller="Subject" asp-action="Create" asp-route-semesterId="@semesterId" asp-route-programId="@programId" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Add Subject
            </a>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function deleteSubject(id,btn){
                 Swal.fire({
                    title: "Are you sure?",
                    text: "You won't be able to undo this!.This will affect teacher assignment",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Yes, delete it!"
                 }).then((result)=>{
                     if(result.isConfirmed){
                          $.ajax({
                                   url:"/Subject/Delete",
                                   type:"POST",
                                   data:{subjectId:id},
                                   success:function(response){
                                        if(response.success){
                                            toastr.success(response.message);
                                            $(btn).closest('tr').fadeOut(500, function()
                                            {
                                                $(this).remove();
                                            });
                                        }else
                                        {
                                            toastr.error(response.message);
                                        }

                                   },
                                   error: function()
                                   {
                                        toastr.error("Unexpected error occured");
                                   }
                          });

                     }
                 });

        }

    </script>
}


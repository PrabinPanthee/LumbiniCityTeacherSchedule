@model IEnumerable<LumbiniCityTeacherSchedule.Models.Models.Program>


@{
    ViewData["Title"] = "Programs List";
}

<div class="card shadow border-0 mt-4">
    <div class="card-header bg-secondary bg-gradient py-3">
        <div class="row">
            <div class="col-12 text-center">
                <h2 class="text-white py-2">Programs List</h2>
            </div>
        </div>
    </div>
    <div class="card-body p-4">
        <div class="row mb-3">
            <div class="col-12 text-end">
                <a asp-action="Create" class="btn btn-primary">Create Program</a>
            </div>
        </div>

        @if (Model.Any())
        {
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Program Name</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var program in Model.Select((value, index) => new { value, index }))
                    {
                        <tr>
                            <td>@(program.index + 1)</td> <!-- Auto-incremented number -->
                            <td>@program.value.ProgramName</td>
                            <td>
                                <a asp-controller="Semester" asp-action="Index" asp-route-id="@program.value.ProgramId" class="btn btn-info btn-sm">Semesters</a>
                                <a href="#" onclick="deleteProgram(@program.value.ProgramId, this)" class="btn btn-danger btn-sm">Delete</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            @* <div id="messageContainer" style="display: none;" class="alert" role="alert"></div> *@
        }
        else
        {
            <div class="alert alert-info">No programs available.</div>
        }
    </div>
</div>

@section Scripts{
    <script>
        //manual jquery for delete 
        // function deleteProgram(id,btn){
        //     $.ajax({
        //         url:'/Program/Remove',
        //         type:'POST',
        //         data:{id:id},
        //         success:function(response){
        //             showMessage(response.message,response.success ? 'success':'danger');

        //             if (response.success){
        //                 $(btn).closest('tr').fadeOut(300,function(){
        //                     $(this).remove();
        //                 });
        //             }
        //         },
        //         error:function(){
        //             showMessage("Something went wrong while trying to delete .",'danger');
        //         }
        //     });

        // }

        // function showMessage(message,type){
        //  var alertHtml = `
        //         <div class="alert alert-${type} alert-dismissible fade show" role="alert">
        //             ${message}
        //             <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        //         </div>`;
        //     $('#messageContainer').html(alertHtml).show();
        // }

        function deleteProgram(id, btn) {
            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to undo this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, delete it!"
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url:"/Admin/Program/Remove",
                        type: 'POST',
                        data: { id: id },
                        success: function (response) {
                            if (response.success) {
                                toastr.success(response.message);
                                // Remove the row from table
                                $(btn).closest('tr').fadeOut(500, function () {
                                    $(this).remove();
                                });
                            } else {
                                toastr.error(response.message);
                            }
                        },
                        error: function () {
                            toastr.error("An unexpected error occurred.");
                        }
                    });
                }
            });
        }
    </script>
}
